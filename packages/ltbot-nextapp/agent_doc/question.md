# é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é‡è¦çš„é—®é¢˜è§£å†³æ–¹æ¡ˆæ±‡æ€»

1.å¼‚æ­¥æ•…äº‹ç”ŸæˆåŠŸèƒ½
2.ç§»åŠ¨ç«¯ BottomNav é€‚é…æ–¹æ¡ˆ


# =======================å¼‚æ­¥æ•…äº‹ç”ŸæˆåŠŸèƒ½å®æ–½æŒ‡å—================

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†æ•…äº‹å¼‚æ­¥ç”ŸæˆåŠŸèƒ½çš„å®æ–½ç»†èŠ‚ã€‚è¯¥åŠŸèƒ½è§£å†³äº† DeepSeek API è°ƒç”¨è€—æ—¶é•¿ï¼ˆ10-30ç§’ï¼‰å¯¼è‡´çš„ç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚

### ä¼˜åŒ–å‰åå¯¹æ¯”

| æ–¹é¢ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| ç”¨æˆ·ç­‰å¾…æ—¶é—´ | 10-30ç§’ | < 1ç§’ |
| é¡µé¢å“åº” | é•¿æ—¶é—´ loading | ç«‹å³è·³è½¬ |
| å¤±è´¥é£é™© | ç”¨æˆ·å…³é—­é¡µé¢å¯¼è‡´ç§¯åˆ†æŸå¤± | åå°æ‰§è¡Œï¼Œå®‰å…¨å¯é  |
| ç”¨æˆ·ä½“éªŒ | ğŸ˜° ç„¦è™‘ç­‰å¾… | ğŸ˜Š æµç•…æ“ä½œ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆæ•…äº‹"
      â†“
è¡¨å•éªŒè¯ + ç§¯åˆ†æ£€æŸ¥
      â†“
ä¿å­˜æ•…äº‹åŸºç¡€ä¿¡æ¯ï¼ˆçŠ¶æ€: pendingï¼‰
      â†“
æ‰£é™¤ç§¯åˆ†
      â†“
è§¦å‘åå°å¼‚æ­¥ç”Ÿæˆä»»åŠ¡ â† ä¸ç­‰å¾…è¿”å›
      â†“
ç«‹å³è·³è½¬åˆ°æ•…äº‹åˆ—è¡¨é¡µ
      â†“
ã€åå°ã€‘è°ƒç”¨ DeepSeek API
      â†“
ã€åå°ã€‘æ›´æ–°æ•…äº‹å†…å®¹ï¼ˆçŠ¶æ€: completedï¼‰
      â†“
ã€å‰ç«¯ã€‘è½®è¯¢åˆ·æ–°æ˜¾ç¤ºæœ€æ–°çŠ¶æ€
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

### 1. å‰ç«¯é¡µé¢
- âœ… `src/app/create-story/page.tsx` - åˆ›å»ºæ•…äº‹é¡µé¢
- âœ… `src/app/to-explore-story/components/StoryCard.tsx` - æ•…äº‹å¡ç‰‡ç»„ä»¶
- âœ… `src/app/to-explore-story/components/StoryListClient.tsx` - æ•…äº‹åˆ—è¡¨å®¢æˆ·ç«¯ç»„ä»¶

### 2. åç«¯ API
- âœ… `src/app/api/stories/generate-async/route.ts` - **æ–°å¢**å¼‚æ­¥ç”Ÿæˆ API

### 3. é…ç½®æ–‡ä»¶
- âœ… `env.production.example` - ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ•°æ®åº“è®¾è®¡ï¼ˆextData å­—æ®µï¼‰

Story æ¨¡å‹çš„ `extData` å­—æ®µï¼ˆJSON æ ¼å¼ï¼‰å¢åŠ ä»¥ä¸‹å­—æ®µï¼š

```typescript
{
  "wordRange": "200-500",                        // åŸæœ‰å­—æ®µ
  "generationStatus": "pending",                 // ç”ŸæˆçŠ¶æ€
  "generationStartedAt": "2026-01-06T10:00:00Z", // å¼€å§‹æ—¶é—´
  "generationCompletedAt": "2026-01-06T10:00:30Z", // å®Œæˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰
  "generationError": null                        // é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
}
```

#### çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | å«ä¹‰ | æ˜¾ç¤º |
|------|------|------|
| `pending` | ç­‰å¾…ç”Ÿæˆ | ğŸŸ¡ ç”Ÿæˆä¸­ |
| `generating` | æ­£åœ¨ç”Ÿæˆ | ğŸŸ¡ ç”Ÿæˆä¸­ |
| `completed` | ç”Ÿæˆå®Œæˆ | âœ… æ­£å¸¸æ˜¾ç¤º |
| `failed` | ç”Ÿæˆå¤±è´¥ | âŒ ç”Ÿæˆå¤±è´¥ |

---

### 2. API æ¥å£

#### POST `/api/stories/generate-async`

è§¦å‘å¼‚æ­¥ç”Ÿæˆæ•…äº‹å†…å®¹ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "storyId": 123,
  "formData": {
    "ageGroup": "3-5å²",
    "storySubjectType": "classic",
    "storySubject": "å†’é™©",
    "storyChildSubject": "æ£®æ—æ¢é™©",
    "characterSetting": "å°å…”å­æ³¢æ¯”...",
    "wordCountLimit": "200-500"
  }
}
```

**å“åº”ï¼ˆç«‹å³è¿”å› 202ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "æ•…äº‹ç”Ÿæˆä»»åŠ¡å·²å¯åŠ¨",
  "data": {
    "storyId": 123
  }
}
```

---

### 3. å‰ç«¯å®ç°è¦ç‚¹

#### 3.1 åˆ›å»ºæ•…äº‹é¡µé¢ (`create-story/page.tsx`)

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// 1. å‡†å¤‡æ•…äº‹æ•°æ®æ—¶ï¼Œè®¾ç½® pending çŠ¶æ€
const storyData = {
  // ... å…¶ä»–å­—æ®µ
  extData: JSON.stringify({
    wordRange: formData.wordCountLimit,
    generationStatus: 'pending',
    generationStartedAt: new Date().toISOString(),
  }),
};

// 2. è§¦å‘å¼‚æ­¥ä»»åŠ¡ï¼ˆä¸ç­‰å¾…ï¼‰
fetch('/api/stories/generate-async', {
  method: 'POST',
  body: JSON.stringify({ storyId: story.id, formData }),
}).catch(err => console.error('è§¦å‘ç”Ÿæˆä»»åŠ¡å¤±è´¥:', err));

// 3. ç«‹å³è·³è½¬
router.push('/to-explore-story');
```

#### 3.2 æ•…äº‹å¡ç‰‡ç»„ä»¶ (`StoryCard.tsx`)

**æ–°å¢åŠŸèƒ½ï¼š**
1. âœ… è§£æ `extData` è·å–ç”ŸæˆçŠ¶æ€
2. âœ… æ˜¾ç¤º"ç”Ÿæˆä¸­"åŠ¨ç”»æ ‡ç­¾
3. âœ… æ˜¾ç¤º"ç”Ÿæˆå¤±è´¥"é”™è¯¯æç¤º
4. âœ… æ­£åœ¨ç”Ÿæˆæ—¶æ˜¾ç¤ºå ä½ç¬¦

**è§†è§‰æ•ˆæœï¼š**
- ğŸŸ¡ ç”Ÿæˆä¸­ï¼šé»„è‰²æ ‡ç­¾ + è„‰å†²åŠ¨ç”»
- âŒ ç”Ÿæˆå¤±è´¥ï¼šçº¢è‰²æ ‡ç­¾ + é”™è¯¯ä¿¡æ¯
- â³ AI æ­£åœ¨åˆ›ä½œï¼šä¸‰ä¸ªè·³åŠ¨çš„ç‚¹

#### 3.3 æ•…äº‹åˆ—è¡¨å®¢æˆ·ç«¯ (`StoryListClient.tsx`)

**æ–°å¢åŠŸèƒ½ï¼š**
1. âœ… æ£€æµ‹æ­£åœ¨ç”Ÿæˆçš„æ•…äº‹
2. âœ… è‡ªåŠ¨è½®è¯¢åˆ·æ–°ï¼ˆæ¯ 5 ç§’ï¼‰
3. âœ… æ‰€æœ‰æ•…äº‹å®Œæˆååœæ­¢è½®è¯¢

**è½®è¯¢é€»è¾‘ï¼š**
```typescript
useEffect(() => {
  if (!hasGeneratingStories()) return;

  const interval = setInterval(() => {
    refreshGeneratingStories(); // åˆ·æ–°æ­£åœ¨ç”Ÿæˆçš„æ•…äº‹
  }, 5000);

  return () => clearInterval(interval);
}, [stories]);
```

---

### 4. åç«¯å®ç°è¦ç‚¹

#### 4.1 å¼‚æ­¥ç”Ÿæˆå¤„ç†

**æ ¸å¿ƒå‡½æ•°ï¼š** `generateStoryInBackground()`

```typescript
async function generateStoryInBackground(storyId, formData) {
  try {
    // 1. æ›´æ–°çŠ¶æ€ä¸º generating
    await updateStoryStatus(storyId, 'generating');

    // 2. ç”Ÿæˆ prompt
    const prompt = generatePrompt(formData);

    // 3. è°ƒç”¨ DeepSeek APIï¼ˆå¸¦é‡è¯•ï¼‰
    const content = await callAIWithRetry(prompt, 3);

    // 4. æ›´æ–°æ•…äº‹å†…å®¹å’ŒçŠ¶æ€
    await prisma.story.update({
      where: { id: storyId },
      data: {
        content: content,
        extData: JSON.stringify({
          generationStatus: 'completed',
          generationCompletedAt: new Date().toISOString(),
        }),
      },
    });
  } catch (error) {
    // 5. å¤±è´¥å¤„ç†
    await updateStoryStatus(storyId, 'failed', error.message);
  }
}
```

#### 4.2 é”™è¯¯å¤„ç†ä¸é‡è¯•

**é‡è¯•ç­–ç•¥ï¼š**
- æœ€å¤šé‡è¯• 3 æ¬¡
- æŒ‡æ•°é€€é¿ï¼š2ç§’ â†’ 4ç§’ â†’ 8ç§’
- è¶…æ—¶æ—¶é—´ï¼š60 ç§’

```typescript
async function callAIWithRetry(prompt, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await callDeepSeekAPI(prompt);
    } catch (error) {
      if (attempt < maxRetries) {
        const delay = Math.pow(2, attempt) * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
  throw new Error('API è°ƒç”¨å¤±è´¥');
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.production` æˆ– `.env.local` ä¸­æ·»åŠ ï¼š

```bash
# DeepSeek API é…ç½®
DEEPSEEK_API_KEY=sk-your-api-key-here
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
DEEPSEEK_MODEL=deepseek-chat
```

### 2. æ•°æ®åº“è¿ç§»

æ•°æ®åº“ç»“æ„æ— éœ€ä¿®æ”¹ï¼Œ`extData` å­—æ®µå·²å­˜åœ¨ã€‚ç°æœ‰æ•…äº‹ä¼šè‡ªåŠ¨å…¼å®¹ï¼ˆé»˜è®¤ä¸º `completed` çŠ¶æ€ï¼‰ã€‚

### 3. ä»£ç éƒ¨ç½²

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœ‰æ›´æ–°ï¼‰
pnpm install

# 3. æ„å»ºé¡¹ç›®
pnpm build

# 4. é‡å¯æœåŠ¡
pm2 restart ltbot-nextapp
# æˆ– Docker é‡å¯
docker-compose up -d --build
```

### 4. éªŒè¯åŠŸèƒ½

#### æµ‹è¯•æµç¨‹ï¼š
1. âœ… ç™»å½•ç³»ç»Ÿï¼Œè¿›å…¥åˆ›å»ºæ•…äº‹é¡µé¢
2. âœ… å¡«å†™è¡¨å•ï¼Œç‚¹å‡»"ç”Ÿæˆæ•…äº‹"
3. âœ… éªŒè¯æ˜¯å¦ç«‹å³è·³è½¬åˆ°åˆ—è¡¨é¡µï¼ˆ< 1ç§’ï¼‰
4. âœ… éªŒè¯æ•…äº‹å¡ç‰‡æ˜¾ç¤º"ç”Ÿæˆä¸­"æ ‡ç­¾
5. âœ… ç­‰å¾… 10-30 ç§’ï¼ŒéªŒè¯è‡ªåŠ¨åˆ·æ–°
6. âœ… éªŒè¯æ•…äº‹å†…å®¹æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### è§†è§‰åé¦ˆ

| çŠ¶æ€ | æ ‡ç­¾æ ·å¼ | å†…å®¹åŒºåŸŸ |
|------|----------|----------|
| ç”Ÿæˆä¸­ | ğŸŸ¡ é»„è‰²è„‰å†² + "ç”Ÿæˆä¸­" | â³ ä¸‰ä¸ªè·³åŠ¨çš„ç‚¹ + "AI æ­£åœ¨åˆ›ä½œæ•…äº‹ä¸­..." |
| ç”Ÿæˆå¤±è´¥ | ğŸ”´ çº¢è‰² + "ç”Ÿæˆå¤±è´¥" | ğŸ˜” "æ•…äº‹ç”Ÿæˆå¤±è´¥" + é”™è¯¯ä¿¡æ¯ |
| å·²å®Œæˆ | âœ… æ— ç‰¹æ®Šæ ‡ç­¾ | ğŸ“ æ­£å¸¸æ˜¾ç¤ºæ•…äº‹å†…å®¹ |

### åŠ¨ç”»æ•ˆæœ

- **è„‰å†²åŠ¨ç”»**ï¼šæ ‡ç­¾å‘¼å¸æ•ˆæœ
- **è·³åŠ¨ç‚¹**ï¼šä¸‰ä¸ªç‚¹ä¾æ¬¡è·³åŠ¨
- **è‡ªåŠ¨åˆ·æ–°**ï¼šæ— æ„ŸçŸ¥æ›´æ–°

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—è¾“å‡º

åç«¯ä¼šè¾“å‡ºè¯¦ç»†çš„ç”Ÿæˆæ—¥å¿—ï¼š

```
[Story 123] å¼€å§‹ç”Ÿæˆæ•…äº‹å†…å®¹...
[Story 123] ç”Ÿæˆçš„ prompt: ...
å°è¯•è°ƒç”¨ DeepSeek API (ç¬¬ 1/3 æ¬¡)...
[Story 123] æ•…äº‹å†…å®¹ç”ŸæˆæˆåŠŸï¼Œé•¿åº¦: 456
[Story 123] çŠ¶æ€å·²æ›´æ–°ä¸º: completed
[Story 123] æ•…äº‹ç”Ÿæˆå®Œæˆï¼
```

### é”™è¯¯ç›‘æ§

å¤±è´¥æƒ…å†µä¼šè®°å½•åˆ° `extData.generationError`ï¼š
- API è°ƒç”¨å¤±è´¥
- è¶…æ—¶é”™è¯¯
- ç½‘ç»œé”™è¯¯

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. API å¯†é’¥å®‰å…¨
- âœ… API å¯†é’¥å­˜å‚¨åœ¨æœåŠ¡ç«¯ç¯å¢ƒå˜é‡
- âœ… å‰ç«¯ä»£ç ä¸­å·²ç§»é™¤ API é…ç½®
- âŒ ä¸è¦å°†å¯†é’¥æäº¤åˆ° Git

### 2. å¹¶å‘æ§åˆ¶
- å½“å‰ç‰ˆæœ¬ï¼šæ— å¹¶å‘é™åˆ¶
- å»ºè®®ï¼šä¸šåŠ¡é‡å¢é•¿åæ·»åŠ é˜Ÿåˆ—é™æµ

### 3. ç§¯åˆ†å¤„ç†
- å½“å‰ï¼šåˆ›å»ºæ•…äº‹åç«‹å³æ‰£é™¤ç§¯åˆ†
- æœªæ¥ä¼˜åŒ–ï¼šç”ŸæˆæˆåŠŸåå†æ‰£é™¤

### 4. é”™è¯¯æ¢å¤
- ç”¨æˆ·å¯åˆ·æ–°é¡µé¢æŸ¥çœ‹æœ€æ–°çŠ¶æ€
- å¤±è´¥çš„æ•…äº‹å¯æ·»åŠ "é‡è¯•"æŒ‰é’®ï¼ˆå¾…å®ç°ï¼‰

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### ç¬¬ä¸€é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰âœ…
- [x] åŸºç¡€å¼‚æ­¥ç”Ÿæˆ
- [x] çŠ¶æ€è½®è¯¢
- [x] è§†è§‰åé¦ˆ

### ç¬¬äºŒé˜¶æ®µï¼ˆæ¨èï¼‰
- [ ] Server-Sent Events (SSE) å®æ—¶æ¨é€
- [ ] å¤±è´¥æ•…äº‹é‡è¯•æŒ‰é’®
- [ ] ç”Ÿæˆè¿›åº¦æ˜¾ç¤ºï¼ˆ0%-100%ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼ˆç”Ÿäº§ä¼˜åŒ–ï¼‰
- [ ] å¼•å…¥ Redis + BullMQ æ¶ˆæ¯é˜Ÿåˆ—
- [ ] ä»»åŠ¡æŒä¹…åŒ–ï¼ˆæœåŠ¡é‡å¯ä¸ä¸¢å¤±ï¼‰
- [ ] ä»»åŠ¡ç›‘æ§é¢æ¿
- [ ] é‚®ä»¶/ç«™å†…ä¿¡é€šçŸ¥

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: æœåŠ¡é‡å¯åæ­£åœ¨ç”Ÿæˆçš„æ•…äº‹ä¼šæ€æ ·ï¼Ÿ
A: å½“å‰ç‰ˆæœ¬ä¼šä¸¢å¤±ï¼ŒçŠ¶æ€åœç•™åœ¨ `generating`ã€‚å¯æ‰‹åŠ¨æ›´æ–°çŠ¶æ€æˆ–ç­‰å¾…æœªæ¥é˜Ÿåˆ—æ–¹æ¡ˆã€‚

### Q2: å¦‚ä½•æ‰‹åŠ¨è§¦å‘é‡æ–°ç”Ÿæˆï¼Ÿ
A: æš‚æ— å‰ç«¯å…¥å£ï¼Œå¯é€šè¿‡ API æ‰‹åŠ¨è°ƒç”¨ï¼š
```bash
curl -X POST http://localhost:3100/api/stories/generate-async \
  -H "Content-Type: application/json" \
  -d '{"storyId": 123, "formData": {...}}'
```

### Q3: è½®è¯¢ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ
A: å½±å“å¾ˆå°ã€‚ä»…å½“æœ‰æ­£åœ¨ç”Ÿæˆçš„æ•…äº‹æ—¶æ‰è½®è¯¢ï¼Œä¸”ä»…æŸ¥è¯¢ç‰¹å®šæ•…äº‹ï¼Œä¸ä¼šå…¨é‡æŸ¥è¯¢ã€‚

### Q4: å¦‚ä½•è°ƒæ•´è½®è¯¢é¢‘ç‡ï¼Ÿ
A: ä¿®æ”¹ `StoryListClient.tsx` ä¸­çš„é—´éš”æ—¶é—´ï¼š
```typescript
const interval = setInterval(() => {
  refreshGeneratingStories();
}, 5000); // æ”¹ä¸ºå…¶ä»–å€¼ï¼Œå¦‚ 3000 (3ç§’) æˆ– 10000 (10ç§’)
```

---

## ğŸ“§ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- æŠ€æœ¯è´Ÿè´£äººï¼š[æ‚¨çš„åå­—]
- é‚®ç®±ï¼š[æ‚¨çš„é‚®ç®±]

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£](./API_DOCUMENTATION.md)
- [Docker éƒ¨ç½²æŒ‡å—](./DOCKER_DEPLOYMENT_GUIDE.md)
- [é…ç½®æŒ‡å—](./configuration-guide.md)

---

**æœ€åæ›´æ–°æ—¶é—´ï¼š** 2026-01-06  
**ç‰ˆæœ¬ï¼š** v1.0.0  
**å®æ–½çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ




# ======================ç§»åŠ¨ç«¯ BottomNav é€‚é…æ–¹æ¡ˆ=======================

## ğŸ“‹ é—®é¢˜æè¿°

ç§»åŠ¨ç«¯ä¼šå‡ºç° `BottomNav` ç»„ä»¶ï¼ˆåº•éƒ¨å¯¼èˆªæ ï¼‰ï¼Œé«˜åº¦çº¦ 60pxï¼Œå›ºå®šåœ¨å±å¹•åº•éƒ¨ï¼Œå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š

1. **é¡µé¢å†…å®¹è¢«é®æŒ¡**ï¼šé¡µé¢åº•éƒ¨çš„å†…å®¹è¢« `BottomNav` é®æŒ¡ï¼Œç”¨æˆ·æ— æ³•çœ‹åˆ°
2. **å›ºå®šå…ƒç´ é‡å **ï¼šæ•…äº‹è¯¦æƒ…é¡µçš„åº•éƒ¨äº’åŠ¨æ ä¸ `BottomNav` é‡å ï¼Œæ˜¾ç¤ºå¼‚å¸¸

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

åˆ›å»ºè®¾å¤‡æ£€æµ‹ Hook (`useDevice`)ï¼Œåœ¨ç§»åŠ¨ç«¯ï¼ˆ< 768pxï¼‰ä¸ºé¡µé¢æ·»åŠ åº•éƒ¨ç•™ç™½ï¼Œé¿å…å†…å®¹è¢«é®æŒ¡ã€‚

### æ ¸å¿ƒæ€è·¯

```
ç§»åŠ¨ç«¯å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¡µé¢å†…å®¹           â”‚
â”‚                     â”‚
â”‚   pb-[100-200px]    â”‚ â† åº•éƒ¨ç•™ç™½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å›ºå®šäº’åŠ¨æ  (å¯é€‰)    â”‚ â† pb-[60px]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BottomNav (60px)    â”‚ â† å…¨å±€åº•éƒ¨å¯¼èˆª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¡Œé¢ç«¯å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¡µé¢å†…å®¹           â”‚
â”‚                     â”‚
â”‚   pb-20             â”‚ â† æ­£å¸¸ç•™ç™½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(æ—  BottomNav)
```

---

## ğŸ”§ å®ç°æ­¥éª¤

### 1. åˆ›å»ºè®¾å¤‡æ£€æµ‹ Hook

**æ–‡ä»¶ï¼š** `src/hooks/useDevice.ts`

```typescript
'use client';

import { useState, useEffect } from 'react';

/**
 * æ£€æµ‹è®¾å¤‡ç±»å‹çš„ Hook
 * @returns isMobile - æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡ï¼ˆ< 768pxï¼‰
 */
export function useDevice() {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    // åˆå§‹åŒ–æ—¶æ£€æµ‹
    const checkDevice = () => {
      setIsMobile(window.innerWidth < 768);
    };

    // é¦–æ¬¡æ£€æµ‹
    checkDevice();

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', checkDevice);

    return () => window.removeEventListener('resize', checkDevice);
  }, []);

  return { isMobile };
}
```

**ç‰¹ç‚¹ï¼š**
- âœ… å®¢æˆ·ç«¯ç»„ä»¶ä¸“ç”¨
- âœ… å“åº”å¼ç›‘å¬çª—å£å˜åŒ–
- âœ… æ–­ç‚¹ï¼š768pxï¼ˆTailwind çš„ `md` æ–­ç‚¹ï¼‰
- âœ… è‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

---

### 2. ä¿®æ”¹æ•…äº‹è¯¦æƒ…é¡µ

**æ–‡ä»¶ï¼š** `src/app/to-explore-story/[id]/page.tsx`

#### 2.1 å¯¼å…¥ Hook

```typescript
import { useDevice } from '@/hooks/useDevice';
```

#### 2.2 ä½¿ç”¨ Hook

```typescript
export default function StoryDetailPage() {
    const { isMobile } = useDevice();
    // ... å…¶ä»–ä»£ç 
}
```

#### 2.3 ä¿®æ”¹ä¸»å®¹å™¨

**ä¿®æ”¹å‰ï¼š**
```typescript
<div className="min-h-screen bg-white pb-20">
```

**ä¿®æ”¹åï¼š**
```typescript
<div className={`min-h-screen bg-white ${isMobile ? 'pb-[200px]' : 'pb-20'}`}>
```

**è¯´æ˜ï¼š**
- ç§»åŠ¨ç«¯ï¼š`pb-[200px]` = 200px åº•éƒ¨ç•™ç™½
  - åº•éƒ¨äº’åŠ¨æ ï¼š~70px
  - BottomNavï¼š60px
  - é¢å¤–ç•™ç™½ï¼š70px
- æ¡Œé¢ç«¯ï¼š`pb-20` = 80px æ­£å¸¸ç•™ç™½

#### 2.4 ä¿®æ”¹åº•éƒ¨äº’åŠ¨æ 

**ä¿®æ”¹å‰ï¼š**
```typescript
<div className={`fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-50 md:top-auto md:bottom-auto ${true ? 'pb-[60px]' : ''}`}>
```

**ä¿®æ”¹åï¼š**
```typescript
<div className={`fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-40 ${isMobile ? 'pb-[60px]' : ''}`}>
```

**è¯´æ˜ï¼š**
- ç§»åŠ¨ç«¯ï¼šæ·»åŠ  `pb-[60px]`ï¼Œé¿å…è¢« BottomNav é®æŒ¡
- æ¡Œé¢ç«¯ï¼šæ— éœ€é¢å¤– padding
- z-index ä» 50 æ”¹ä¸º 40ï¼Œç¡®ä¿å±‚çº§æ­£ç¡®

---

### 3. ä¿®æ”¹ä¸ªäººä¸­å¿ƒé¡µ

**æ–‡ä»¶ï¼š** `src/app/to-view-mine/page.tsx`

#### 3.1 å¯¼å…¥ Hook

```typescript
import { useDevice } from '@/hooks/useDevice';
```

#### 3.2 ä½¿ç”¨ Hook

```typescript
export default function ViewMinePage() {
    const { isMobile } = useDevice();
    // ... å…¶ä»–ä»£ç 
}
```

#### 3.3 ä¿®æ”¹ä¸»å®¹å™¨

**ä¿®æ”¹å‰ï¼š**
```typescript
<div className="min-h-screen bg-gray-50 pb-20">
```

**ä¿®æ”¹åï¼š**
```typescript
<div className={`min-h-screen bg-gray-50 ${isMobile ? 'pb-[100px]' : 'pb-20'}`}>
```

**è¯´æ˜ï¼š**
- ç§»åŠ¨ç«¯ï¼š`pb-[100px]` = 100px åº•éƒ¨ç•™ç™½ï¼ˆBottomNav 60px + 40px é¢å¤–ç©ºé—´ï¼‰
- æ¡Œé¢ç«¯ï¼š`pb-20` = 80px æ­£å¸¸ç•™ç™½

---

### 4. ä¿®æ”¹æ•…äº‹åˆ—è¡¨é¡µ

**æ–‡ä»¶ï¼š** `src/app/to-explore-story/page.tsx`

ç”±äºè¿™æ˜¯**æœåŠ¡ç«¯ç»„ä»¶**ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯ Hookï¼Œéœ€è¦åˆ›å»ºåŒ…è£…ç»„ä»¶ã€‚

#### 4.1 åˆ›å»ºåŒ…è£…ç»„ä»¶

**æ–‡ä»¶ï¼š** `src/app/to-explore-story/components/PageWrapper.tsx`

```typescript
'use client';
import { useDevice } from '@/hooks/useDevice';
import { ReactNode } from 'react';

interface PageWrapperProps {
    children: ReactNode;
}

export default function PageWrapper({ children }: PageWrapperProps) {
    const { isMobile } = useDevice();

    return (
        <div className={`min-h-screen bg-gradient-to-b from-purple-50 via-pink-50 to-blue-50 ${isMobile ? 'pb-[80px]' : ''}`}>
            {children}
        </div>
    );
}
```

#### 4.2 ä½¿ç”¨åŒ…è£…ç»„ä»¶

**ä¿®æ”¹å‰ï¼š**
```typescript
return (
    <div className="min-h-screen bg-gradient-to-b from-purple-50 via-pink-50 to-blue-50">
        {/* å†…å®¹ */}
    </div>
);
```

**ä¿®æ”¹åï¼š**
```typescript
import PageWrapper from "./components/PageWrapper";

return (
    <PageWrapper>
        {/* å†…å®¹ */}
    </PageWrapper>
);
```

---

## ğŸ“Š åº•éƒ¨ç•™ç™½å°ºå¯¸å¯¹ç…§è¡¨

| é¡µé¢ | ç§»åŠ¨ç«¯ | æ¡Œé¢ç«¯ | è¯´æ˜ |
|------|--------|--------|------|
| **æ•…äº‹è¯¦æƒ…é¡µ** | `pb-[200px]` | `pb-20` | æœ‰åº•éƒ¨äº’åŠ¨æ  + BottomNav |
| **ä¸ªäººä¸­å¿ƒé¡µ** | `pb-[100px]` | `pb-20` | åªæœ‰ BottomNav |
| **æ•…äº‹åˆ—è¡¨é¡µ** | `pb-[80px]` | æ—  | åªæœ‰ BottomNav |
| **è¯¦æƒ…é¡µäº’åŠ¨æ ** | `pb-[60px]` | æ—  | é¿å…è¢« BottomNav é®æŒ¡ |

---

## ğŸ¨ BottomNav ç»„ä»¶ä¿¡æ¯

**æ–‡ä»¶ï¼š** `src/app/components/BottomNav.tsx`

**ç‰¹ç‚¹ï¼š**
```typescript
<div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-4 z-50 md:hidden">
```

- **å®šä½ï¼š** `fixed bottom-0` - å›ºå®šåœ¨åº•éƒ¨
- **é«˜åº¦ï¼š** çº¦ 60pxï¼ˆ`py-2` + å†…å®¹ + borderï¼‰
- **æ˜¾ç¤ºï¼š** `md:hidden` - åªåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼ˆ< 768pxï¼‰
- **å±‚çº§ï¼š** `z-50` - è¾ƒé«˜çš„ z-index

---

## ğŸ” å±‚çº§å…³ç³»

```
z-index å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
z-50: BottomNav (å…¨å±€åº•éƒ¨å¯¼èˆª)
z-50: é¡¶éƒ¨å¯¼èˆªæ 
z-40: æ•…äº‹è¯¦æƒ…é¡µåº•éƒ¨äº’åŠ¨æ 
z-10: æ•…äº‹åˆ—è¡¨é¡µå¤´éƒ¨
```

---

## âœ… ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- [x] `src/hooks/useDevice.ts` - è®¾å¤‡æ£€æµ‹ Hook
- [x] `src/app/to-explore-story/components/PageWrapper.tsx` - é¡µé¢åŒ…è£…ç»„ä»¶

### ä¿®æ”¹æ–‡ä»¶
- [x] `src/app/to-explore-story/[id]/page.tsx` - æ•…äº‹è¯¦æƒ…é¡µ
- [x] `src/app/to-view-mine/page.tsx` - ä¸ªäººä¸­å¿ƒé¡µ
- [x] `src/app/to-explore-story/page.tsx` - æ•…äº‹åˆ—è¡¨é¡µ

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯• 1ï¼šç§»åŠ¨ç«¯é€‚é…

```bash
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°ç§»åŠ¨è®¾å¤‡è§†å›¾ï¼ˆ< 768pxï¼‰
3. è®¿é—®å„ä¸ªé¡µé¢
4. æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
5. éªŒè¯ï¼š
   âœ… å†…å®¹ä¸è¢« BottomNav é®æŒ¡
   âœ… åº•éƒ¨æœ‰è¶³å¤Ÿçš„ç•™ç™½
   âœ… BottomNav å›ºå®šåœ¨åº•éƒ¨
```

### æµ‹è¯• 2ï¼šæ¡Œé¢ç«¯é€‚é…

```bash
1. åˆ‡æ¢åˆ°æ¡Œé¢è§†å›¾ï¼ˆâ‰¥ 768pxï¼‰
2. è®¿é—®å„ä¸ªé¡µé¢
3. éªŒè¯ï¼š
   âœ… BottomNav ä¸æ˜¾ç¤º
   âœ… åº•éƒ¨ç•™ç™½æ­£å¸¸ï¼ˆpb-20ï¼‰
   âœ… å¸ƒå±€æ­£å¸¸
```

### æµ‹è¯• 3ï¼šå“åº”å¼åˆ‡æ¢

```bash
1. åœ¨æ¡Œé¢ç«¯æ‰“å¼€é¡µé¢
2. é€æ¸ç¼©å°æµè§ˆå™¨çª—å£
3. è§‚å¯Ÿåœ¨ 768px ä¸´ç•Œç‚¹æ—¶ï¼š
   âœ… BottomNav æ˜¾ç¤º/éšè—
   âœ… åº•éƒ¨ç•™ç™½åŠ¨æ€è°ƒæ•´
   âœ… æ— é—ªçƒæˆ–è·³åŠ¨
```

### æµ‹è¯• 4ï¼šæ•…äº‹è¯¦æƒ…é¡µ

```bash
1. ç§»åŠ¨ç«¯è®¿é—®æ•…äº‹è¯¦æƒ…é¡µ
2. æ»šåŠ¨åˆ°è¯„è®ºåŒºåº•éƒ¨
3. éªŒè¯ï¼š
   âœ… è¯„è®ºåŒºå†…å®¹ä¸è¢«é®æŒ¡
   âœ… åº•éƒ¨äº’åŠ¨æ å®Œæ•´æ˜¾ç¤º
   âœ… åº•éƒ¨äº’åŠ¨æ ä¸Šæ–¹æœ‰ BottomNav
   âœ… ç‚¹å‡»äº’åŠ¨æŒ‰é’®æ­£å¸¸
```

---

## ğŸ’¡ è®¾è®¡è¦ç‚¹

### 1. å“åº”å¼æ–­ç‚¹

```css
/* Tailwind æ–­ç‚¹ */
sm: 640px   /* å°å±æ‰‹æœº */
md: 768px   /* å¹³æ¿ï¼ˆæˆ‘ä»¬çš„æ–­ç‚¹ï¼‰ */
lg: 1024px  /* å°ç¬”è®°æœ¬ */
xl: 1280px  /* æ¡Œé¢ */
```

**é€‰æ‹© 768px çš„åŸå› ï¼š**
- âœ… ä¸ Tailwind `md` æ–­ç‚¹ä¸€è‡´
- âœ… ä¸ BottomNav çš„ `md:hidden` ä¸€è‡´
- âœ… è¦†ç›–å¤§éƒ¨åˆ†ç§»åŠ¨è®¾å¤‡ï¼ˆæ‰‹æœº + å°å¹³æ¿ï¼‰

### 2. ç•™ç™½è®¡ç®—

```
æ•…äº‹è¯¦æƒ…é¡µç§»åŠ¨ç«¯ç•™ç™½ = 200px
â”œâ”€ åº•éƒ¨äº’åŠ¨æ é«˜åº¦ï¼š70px
â”œâ”€ BottomNav é«˜åº¦ï¼š60px
â””â”€ é¢å¤–ç¼“å†²ç©ºé—´ï¼š70px

ä¸ªäººä¸­å¿ƒé¡µç§»åŠ¨ç«¯ç•™ç™½ = 100px
â”œâ”€ BottomNav é«˜åº¦ï¼š60px
â””â”€ é¢å¤–ç¼“å†²ç©ºé—´ï¼š40px

æ•…äº‹åˆ—è¡¨é¡µç§»åŠ¨ç«¯ç•™ç™½ = 80px
â”œâ”€ BottomNav é«˜åº¦ï¼š60px
â””â”€ é¢å¤–ç¼“å†²ç©ºé—´ï¼š20px
```

### 3. æ€§èƒ½ä¼˜åŒ–

**useDevice Hook ä¼˜åŒ–ï¼š**
- âœ… ä½¿ç”¨ `resize` äº‹ä»¶ç›‘å¬å™¨ï¼ˆè‡ªåŠ¨èŠ‚æµï¼‰
- âœ… ç»„ä»¶å¸è½½æ—¶æ¸…ç†ç›‘å¬å™¨
- âœ… é¿å…é¢‘ç¹é‡æ–°æ¸²æŸ“

**æ›¿ä»£æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰ï¼š**
```typescript
// âŒ çº¯ CSS æ–¹æ¡ˆï¼ˆæ— æ³•åŠ¨æ€æ£€æµ‹ï¼‰
<div className="pb-20 md:pb-[100px]">

// âŒ ä½¿ç”¨ window.matchMediaï¼ˆæ›´å¤æ‚ï¼‰
const media = window.matchMedia('(max-width: 768px)');
```

---

## ğŸš€ æ‰©å±•å»ºè®®

### æœªæ¥ä¼˜åŒ–

1. **æ·»åŠ å¹³æ»‘è¿‡æ¸¡**
```typescript
<div className="transition-all duration-300 pb-[100px]">
```

2. **æ”¯æŒæ›´å¤šæ–­ç‚¹**
```typescript
export function useDevice() {
  return {
    isMobile: window.innerWidth < 768,
    isTablet: window.innerWidth >= 768 && window.innerWidth < 1024,
    isDesktop: window.innerWidth >= 1024,
  };
}
```

3. **å…¨å±€çŠ¶æ€ç®¡ç†**
```typescript
// ä½¿ç”¨ Context é¿å…æ¯ä¸ªç»„ä»¶éƒ½ç›‘å¬ resize
<DeviceProvider>
  <App />
</DeviceProvider>
```

---

## ğŸ“ æ€»ç»“

### âœ… å®Œæˆçš„å·¥ä½œ

1. âœ… åˆ›å»ºäº† `useDevice` Hookï¼Œå®ç°è®¾å¤‡æ£€æµ‹
2. âœ… ä¿®æ”¹äº† 3 ä¸ªé¡µé¢ï¼Œæ·»åŠ ç§»åŠ¨ç«¯é€‚é…
3. âœ… åˆ›å»ºäº† `PageWrapper` ç»„ä»¶ï¼Œé€‚é…æœåŠ¡ç«¯ç»„ä»¶
4. âœ… ç»Ÿä¸€äº†åº•éƒ¨ç•™ç™½ç­–ç•¥

### ğŸ¯ è§£å†³çš„é—®é¢˜

1. âœ… é¡µé¢å†…å®¹ä¸å†è¢« BottomNav é®æŒ¡
2. âœ… æ•…äº‹è¯¦æƒ…é¡µåº•éƒ¨äº’åŠ¨æ ä¸ BottomNav ä¸å†é‡å 
3. âœ… ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯æœ‰ä¸åŒçš„å¸ƒå±€ç­–ç•¥
4. âœ… å“åº”å¼åˆ‡æ¢æµç•…

### ğŸ”® æŠ€æœ¯äº®ç‚¹

- ğŸ¨ ç»Ÿä¸€çš„è®¾å¤‡æ£€æµ‹ç­–ç•¥
- ğŸ“± ç§»åŠ¨ç«¯ä¼˜å…ˆçš„è®¾è®¡æ€è·¯
- ğŸ”§ çµæ´»çš„ç»„ä»¶åŒ…è£…æ–¹æ¡ˆ
- âœ¨ å“åº”å¼å¸ƒå±€å®Œç¾é€‚é…

**ç°åœ¨ç§»åŠ¨ç«¯å¸ƒå±€é—®é¢˜å·²å®Œç¾è§£å†³ï¼** ğŸ‰

