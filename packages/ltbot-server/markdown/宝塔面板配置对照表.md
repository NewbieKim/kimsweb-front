# 宝塔面板 Node 项目配置对照表

## 📝 配置项说明（对应截图表单）

根据您提供的宝塔面板截图，以下是每个配置项的详细说明：

---

## 🎯 基础配置

### 1. 项目配置 Tab

选择「**项目配置**」选项卡

---

### 2. 项目目录 ⭐
```
配置项: 项目目录
填写值: /www/wwwroot/ltbot-server
说明: 项目文件存放的完整路径
```

**如何设置：**
- 点击输入框右侧的 📁 图标
- 浏览并选择项目上传的目录
- 或直接输入完整路径

---

### 3. 项目名称 ⭐
```
配置项: 项目名称
填写值: ltbot_server
说明: 在宝塔面板中显示的项目名称，不影响实际运行
```

**命名建议：**
- 使用小写字母和下划线
- 避免使用特殊字符
- 简洁明了，便于识别

---

## ⚙️ 域名管理

### 4. 域名管理 Tab

可以选择「**域名管理**」或「**外网映射**」

#### 域名管理（推荐）
```
配置项: 域名管理
填写值: api.yourdomain.com
说明: 绑定自定义域名，需要域名已解析到服务器IP
```

#### 外网映射
```
说明: 自动生成一个临时访问域名
优点: 无需配置域名
缺点: 域名不友好，不适合生产环境
```

---

## 🔧 运行配置

### 5. 启动文件 ⭐
```
配置项: 启动文件
填写值: index.ts
说明: 项目的入口文件（相对于项目目录的路径）
```

**注意事项：**
- 填写相对路径，不是绝对路径
- 如果文件在子目录：`src/index.ts`
- 确保文件存在，否则无法启动

---

### 6. 自动启动 ⭐
```
配置项: 自动启动
填写值: devnpx esno index.ts
说明: 服务器重启后自动启动项目的命令
```

**正确的配置方式：**

**方式一：使用 esno（推荐用于 TypeScript）**
```bash
devnpx esno index.ts
```

**方式二：使用 ts-node**
```bash
npx ts-node index.ts
```

**方式三：如果已编译为 JavaScript**
```bash
node dist/index.js
```

**⚠️ 注意：**
- `dev` 是宝塔的特殊前缀，保持不变
- 后面跟实际的启动命令

---

## 🎨 仓库管理（可选）

### 7. 仓库管理 Tab

如果项目托管在 Git 仓库，可以配置自动部署：

```
Git 仓库地址: https://github.com/yourusername/ltbot-server.git
分支: main
私钥: （如果是私有仓库）
```

---

## 📦 Node 环境配置

### 8. Node版本 ⭐
```
配置项: Node版本
选择值: v22.14.0（或 v20.x.x）
说明: 选择项目需要的 Node.js 版本
```

**版本选择建议：**
- ✅ **v20.x.x**：LTS 长期支持版（推荐）
- ✅ **v22.x.x**：最新稳定版
- ❌ 低于 v18.0.0：不支持（项目要求 >= 18.0.0）

**如何安装新版本：**
```
软件商店 → Node版本管理器 → 安装指定版本
```

---

### 9. 包管理器 ⭐
```
配置项: 包管理器
选择值: npm 或 pnpm
说明: 用于安装依赖的包管理器
```

**选项说明：**

| 包管理器 | 优点 | 缺点 | 推荐度 |
|---------|------|------|--------|
| **npm** | 默认自带，兼容性好 | 速度较慢 | ⭐⭐⭐ |
| **pnpm** | 速度快，节省磁盘空间 | 需要单独安装 | ⭐⭐⭐⭐⭐ |
| **yarn** | 速度快，有离线模式 | 需要单独安装 | ⭐⭐⭐⭐ |

**推荐选择：pnpm**

如果选择 pnpm，需先安装：
```bash
npm install -g pnpm
```

---

## 👤 用户与端口配置

### 10. 运行用户 ⭐
```
配置项: 运行用户
选择值: www
说明: 运行 Node 进程的系统用户
```

**用户选择：**
- ✅ **www**：宝塔默认的 Web 服务用户（推荐）
- ⚠️ **root**：不推荐，存在安全风险
- ℹ️ 自定义用户：需要确保有足够权限

**权限确认：**
```bash
# 检查项目目录所有者
ls -la /www/wwwroot/ltbot-server

# 如果所有者不是 www，修改：
chown -R www:www /www/wwwroot/ltbot-server
```

---

### 11. 项目端口 ⭐
```
配置项: 项目端口
填写值: 3000
说明: Node 应用监听的端口号
```

**端口选择注意事项：**
- 默认端口：3000
- 确保端口未被占用
- 不要使用系统保留端口（0-1024）
- 推荐范围：3000-9000

**检查端口是否被占用：**
```bash
netstat -tulnp | grep 3000
# 或
lsof -i :3000
```

**如果端口被占用，有两种解决方案：**

1. **更改项目端口**（推荐）
   - 修改此配置为其他端口（如 3001）
   - 同时修改 `index.ts` 中的端口配置

2. **停止占用端口的进程**
   ```bash
   # 查找进程 PID
   lsof -i :3000
   # 杀死进程
   kill -9 PID
   ```

---

### 12. 项目备注
```
配置项: 项目备注
填写值: ltbot_server 或 商城后端 API 服务
说明: 项目的描述信息，便于管理识别
```

---

## 🔐 SSL 配置（可选）

### 13. SSL Tab

如果需要 HTTPS 访问：

```
配置项: SSL证书
操作: 申请 Let's Encrypt 免费证书
域名: api.yourdomain.com
```

**配置步骤：**
1. 确保域名已正确解析到服务器
2. 点击 SSL 选项卡
3. 选择 Let's Encrypt
4. 点击申请
5. 等待证书颁发（通常几分钟）
6. 开启「强制 HTTPS」

---

## 📊 配置文件（高级）

### 14. 配置文件 Tab

可以编辑 PM2 配置文件：

```javascript
module.exports = {
  apps: [{
    name: 'ltbot-server',
    script: './index.ts',
    interpreter: 'npx',
    interpreter_args: 'esno',
    // ... 其他配置
  }]
}
```

---

## 🎬 完整配置示例

根据您的截图，完整的配置应该是：

```yaml
项目配置:
  项目目录: /www/wwwroot/ltbot-server
  项目名称: ltbot_server
  启动文件: index.ts
  自动启动: devnpx esno index.ts
  Node版本: v22.14.0
  包管理器: npm (或 pnpm)
  运行用户: www
  项目端口: 3000
  项目备注: ltbot_server
```

---

## ✅ 配置完成后的操作步骤

### 1. 保存修改
点击「**保存修改**」按钮（绿色按钮）

### 2. 映射端口
如果需要外网访问，配置端口映射或域名

### 3. 启动项目
点击项目列表中的「**启动**」按钮

### 4. 查看日志
点击「**日志**」按钮，查看启动日志，确认无错误

### 5. 测试接口
```bash
# 内网测试
curl http://127.0.0.1:3000/api/products

# 外网测试（如果配置了域名）
curl http://api.yourdomain.com/api/products
```

---

## 🔍 配置验证清单

部署完成后，请逐项检查：

- [ ] 项目目录路径正确，文件已上传
- [ ] Node.js 版本符合要求（>= 18.0.0）
- [ ] 依赖已安装（node_modules 目录存在）
- [ ] 启动命令正确无误
- [ ] 端口未被占用
- [ ] 运行用户权限正确
- [ ] 项目状态显示为「运行中」
- [ ] 日志无报错信息
- [ ] API 接口可以正常访问
- [ ] 防火墙已放行端口

---

## 🚨 常见配置错误

### 错误 1：启动文件路径错误
```
❌ 错误: /www/wwwroot/ltbot-server/index.ts
✅ 正确: index.ts
```

### 错误 2：自动启动命令错误
```
❌ 错误: npx esno index.ts
✅ 正确: devnpx esno index.ts
```

### 错误 3：Node 版本太低
```
❌ 错误: v16.x.x
✅ 正确: v20.x.x 或 v22.x.x
```

### 错误 4：端口冲突
```
❌ 症状: 启动失败，日志显示 EADDRINUSE
✅ 解决: 更改端口或停止占用进程
```

---

## 📞 获取帮助

如果配置过程中遇到问题：

1. **查看日志**
   ```
   Node项目 → 找到项目 → 点击「日志」
   ```

2. **查看 PM2 状态**
   ```bash
   pm2 status
   pm2 logs ltbot-server
   ```

3. **检查端口**
   ```bash
   netstat -tulnp | grep 3000
   ```

4. **检查权限**
   ```bash
   ls -la /www/wwwroot/ltbot-server
   ```

---

## 📚 参考资料

- 📘 [宝塔面板官方文档 - Node项目管理](https://www.bt.cn/bbs/thread-99986-1-1.html)
- 📗 [PM2 进程管理器文档](https://pm2.keymetrics.io/docs/usage/quick-start/)
- 📕 [Node.js 版本选择指南](https://nodejs.org/zh-cn/about/previous-releases)

---

**配置完成！** 🎉

按照以上配置填写，点击「保存修改」，然后启动项目即可。

