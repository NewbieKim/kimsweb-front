# 📚 快速开始 - 获取飞书文档空间列表

## 第一步：配置飞书应用凭证

### 1️⃣ 创建飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 登录你的飞书账号
3. 点击右上角「创建应用」→「企业自建应用」
4. 填写应用信息：
   - 应用名称：例如 "文档管理助手"
   - 应用描述：随意填写
   - 点击「创建」

### 2️⃣ 获取应用凭证

1. 在应用管理页面，点击左侧「凭证与基础信息」
2. 复制以下信息：
   - **App ID** (例如：cli_a1b2c3d4e5f6g7h8)
   - **App Secret** (点击查看并复制)

### 3️⃣ 配置应用权限 ⚠️ **重要**

1. 点击左侧「权限管理」
2. 在搜索框输入「云空间」
3. 找到以下权限并开启：
   - ✅ **查看、评论和导出云空间** (`wiki:wiki:readonly`)
   
   或者选择更高权限：
   - ✅ **管理云空间** (`wiki:wiki`)

4. 点击右上角「保存」

### 4️⃣ 发布应用

1. 点击左侧「版本管理与发布」
2. 点击「创建版本」
3. 填写版本说明（随意）
4. 点击「申请发布」
5. 等待管理员审核通过（如果你是管理员，可以自己审核）

---

## 第二步：配置本地环境

### 1️⃣ 创建 .env 文件

在 `packages/doc-mcp/` 目录下创建 `.env` 文件：

```bash
# 方式1：手动创建
# 在 packages/doc-mcp/ 目录下新建文件，命名为 .env

# 方式2：复制示例文件
# 复制 .env.example 文件并重命名为 .env
```

### 2️⃣ 填写凭证

编辑 `.env` 文件，填入你的飞书应用凭证：

```env
FEISHU_APP_ID=cli_你的应用ID
FEISHU_APP_SECRET=你的应用密钥
PORT=7777
```

---

## 第三步：运行测试脚本

### 在 PowerShell 中运行：

```powershell
# 进入项目目录
cd packages\doc-mcp

# 运行测试脚本
npx tsx test-spaces.ts
```

### 或者使用 pnpm（如果配置了 scripts）：

```powershell
# 在项目根目录
pnpm start:doc-mcp
```

---

## 预期输出

如果配置正确，你将看到类似以下输出：

```
============================================================
飞书文档空间列表获取测试
============================================================

✅ 环境变量已配置
📱 App ID: cli_a1b2***

🔄 正在获取访问令牌...
✅ 访问令牌获取成功: t-g104xxxxxxxxxxxxxxxx...

🔄 正在获取文档空间列表...

============================================================
📚 找到 3 个文档空间
============================================================

1. 【产品文档】
   空间ID: 7234567890123456789

2. 【技术文档】
   空间ID: 7234567890123456790

3. 【运营资料】
   空间ID: 7234567890123456791

============================================================
JSON 格式输出：
============================================================
[
  {
    "id": "7234567890123456789",
    "name": "产品文档"
  },
  ...
]
```

---

## 常见问题

### ❌ 错误：未找到飞书应用凭证

**原因**：`.env` 文件不存在或配置不正确

**解决**：检查 `packages/doc-mcp/.env` 文件是否存在，内容是否正确

---

### ❌ 错误：Access denied / 权限不足

**原因**：应用权限未开启或未发布

**解决**：
1. 确认已开启「云空间」相关权限
2. 确认应用已发布并审核通过
3. 尝试重新获取 App Secret

---

### ℹ️ 没有找到任何文档空间

**可能原因**：
1. 应用权限配置不正确
2. 当前飞书账号下确实没有知识空间
3. 应用可见范围限制

**解决**：
- 检查应用权限配置
- 在飞书中创建一个测试知识空间
- 检查应用的可见范围设置

---

## 需要帮助？

如果遇到问题，请检查：
1. ✅ `.env` 文件是否正确配置
2. ✅ 应用权限是否已开启
3. ✅ 应用是否已发布并审核通过
4. ✅ App ID 和 App Secret 是否正确

---

祝你使用愉快！🎉

